### **AI ç†è§£ç”¨æˆ·æ„å›¾ & ä»»åŠ¡åˆ†ç±»æ¶æ„è®¾è®¡**

#### **1. æ¶æ„æ€è·¯**

ä¸ºäº†è®© AI èƒ½å‡†ç¡®ç†è§£ç”¨æˆ·è¾“å…¥ï¼Œå¹¶å¯¹ä¸åŒä»»åŠ¡è¿›è¡Œåˆ†ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ **å¤šå±‚è§£ææ¶æ„**ï¼Œå¦‚ä¸‹ï¼š

- **ç¬¬ä¸€å±‚ï¼šæ„å›¾è¯†åˆ«ï¼ˆIntent Recognitionï¼‰** â€”â€” è§£æç”¨æˆ·è¾“å…¥ï¼Œç¡®å®šæ ¸å¿ƒéœ€æ±‚ï¼Œä¾‹å¦‚æ—¥å¿—æŸ¥è¯¢ã€èµ„æºç›‘æ§ã€å‘Šè­¦å¤„ç†ç­‰ã€‚
- **ç¬¬äºŒå±‚ï¼šä»»åŠ¡æ‹†è§£ï¼ˆTask Decompositionï¼‰** â€”â€” è¿›ä¸€æ­¥åˆ†æä»»åŠ¡çš„å…·ä½“å­ä»»åŠ¡ï¼Œå¦‚ Elasticsearch æŸ¥è¯¢ã€Prometheus ç›‘æ§ã€DeepFlow åˆ†æç­‰ã€‚
- **ç¬¬ä¸‰å±‚ï¼šä»»åŠ¡æ‰§è¡Œï¼ˆTask Executionï¼‰** â€”â€” ç”Ÿæˆé€‚å½“çš„æŸ¥è¯¢ API è¯·æ±‚æˆ–æ“ä½œæŒ‡ä»¤ï¼Œå¹¶è¿”å›ç»“æ„åŒ–çš„ JSON ç»“æœã€‚

---

#### **2. AI è§£æç”¨æˆ·è¾“å…¥çš„ Prompt è®¾è®¡**

ä¸ºäº†æé«˜ AI å¯¹ç”¨æˆ·æ„å›¾çš„ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **DeepSeek** çš„ JSON è¾“å‡ºåŠŸèƒ½ï¼Œç¡®ä¿ç»“æ„åŒ–å“åº”ã€‚

##### **é€šç”¨ Promptï¼ˆç¤ºä¾‹ï¼‰**

```
ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½è¿ç»´åŠ©æ‰‹ï¼Œè´Ÿè´£è§£æç”¨æˆ·è¾“å…¥ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°é¢„å®šä¹‰çš„è¿ç»´ä»»åŠ¡ç±»åˆ«ã€‚
è¯·æ ¹æ®ç”¨æˆ·è¾“å…¥ï¼Œç¡®å®šå…¶æ„å›¾ï¼Œå¹¶å°†ä»»åŠ¡åˆ†ç±»åˆ°ä»¥ä¸‹ç±»åˆ«ï¼š
- "logs_query"ï¼ˆæ—¥å¿—æŸ¥è¯¢ï¼‰
- "metrics_monitoring"ï¼ˆæŒ‡æ ‡ç›‘æ§ï¼‰
- "alerts_management"ï¼ˆå‘Šè­¦ç®¡ç†ï¼‰
- "resource_cost_estimation"ï¼ˆèµ„æºæˆæœ¬é¢„ä¼°ï¼‰
- "deployment_management"ï¼ˆéƒ¨ç½²ç®¡ç†ï¼‰
- "troubleshooting"ï¼ˆæ•…éšœæ’æŸ¥ï¼‰
- "others"ï¼ˆå…¶ä»–ï¼‰

å¦‚æœå¯èƒ½çš„è¯ï¼Œè¯·æå–ç”¨æˆ·çš„ **æŸ¥è¯¢å…³é”®å­—**ï¼Œå¹¶å°è¯•ç”Ÿæˆé€‚åˆçš„ API æŸ¥è¯¢å‚æ•°ã€‚

**ç¤ºä¾‹è¾“å…¥ï¼š**
"è¯·å¸®æˆ‘æŸ¥è¯¢ nginx åœ¨ 10.1.1.1 æœåŠ¡å™¨ä¸Šçš„è®¿é—®æ—¥å¿—ï¼Œå¹¶æ‰¾å‡º 5XX é”™è¯¯ç‡æœ€é«˜çš„æ—¶é—´æ®µã€‚"

**ç¤ºä¾‹ JSON è¾“å‡ºï¼š**
```json
{
    "intent": "logs_query",
    "query_keywords": ["nginx", "10.1.1.1", "5XX"],
    "suggested_api": {
        "service": "elasticsearch",
        "query": {
            "index": "nginx-logs",
            "filter": "host:10.1.1.1 AND status:5XX",
            "aggregation": "time_histogram"
        }
    }
}
```

```

---

#### **3. ä»»åŠ¡åˆ†ç±»çš„ JSON Schema**
ä¸ºäº†è®© AI å§‹ç»ˆè¿”å›ç»“æ„åŒ– JSON å“åº”ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡å¦‚ä¸‹ JSON Schemaï¼š

```json
{
    "type": "object",
    "properties": {
        "intent": {
            "type": "string",
            "enum": [
                "logs_query",
                "metrics_monitoring",
                "alerts_management",
                "resource_cost_estimation",
                "deployment_management",
                "troubleshooting",
                "others"
            ]
        },
        "query_keywords": {
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "suggested_api": {
            "type": "object",
            "properties": {
                "service": { "type": "string" },
                "query": { "type": "object" }
            },
            "required": ["service", "query"]
        }
    },
    "required": ["intent"]
}
```

---

#### **4. AI ä»»åŠ¡åˆ†ç±» & è§£æç¤ºä¾‹**

##### **ç¤ºä¾‹ 1ï¼šæ—¥å¿—æŸ¥è¯¢**

**ç”¨æˆ·è¾“å…¥**

```
è¯·æŸ¥è¯¢ 2024-04-01 æœåŠ¡å™¨ 192.168.1.100 çš„ Nginx è®¿é—®æ—¥å¿—ï¼Œç­›é€‰å‡º 500 é”™è¯¯çš„è¯·æ±‚è¯¦æƒ…ã€‚
```

**AI è§£æçš„ JSON å“åº”**

```json
{
    "intent": "logs_query",
    "query_keywords": ["Nginx", "192.168.1.100", "500 error"],
    "suggested_api": {
        "service": "elasticsearch",
        "query": {
            "index": "nginx-logs",
            "filter": "host:192.168.1.100 AND status:500",
            "fields": ["timestamp", "url", "response_time"]
        }
    }
}
```

---

##### **ç¤ºä¾‹ 2ï¼šèµ„æºæˆæœ¬é¢„ä¼°**

**ç”¨æˆ·è¾“å…¥**

```
å¦‚æœæˆ‘è¦æ‰©å±• 5 å° 16 æ ¸ 64G çš„äº‘æœåŠ¡å™¨ï¼Œå¹¶ä¸”æ¯å¤©è¿è¡Œ 24 å°æ—¶ï¼Œé¢„è®¡ä¸€ä¸ªæœˆçš„è´¹ç”¨æ˜¯å¤šå°‘ï¼Ÿ
```

**AI è§£æçš„ JSON å“åº”**

```json
{
    "intent": "resource_cost_estimation",
    "query_keywords": ["5 å°", "16 æ ¸ 64G", "æ¯å¤© 24 å°æ—¶", "ä¸€ä¸ªæœˆ"],
    "suggested_api": {
        "service": "cloud_cost_estimator",
        "query": {
            "instance_type": "16C64G",
            "quantity": 5,
            "usage_hours_per_day": 24,
            "duration_days": 30
        }
    }
}
```

---

##### **ç¤ºä¾‹ 3ï¼šPrometheus ç›‘æ§æŒ‡æ ‡**

**ç”¨æˆ·è¾“å…¥**

```
è¯·æŸ¥è¯¢ Kubernetes é›†ç¾¤ä¸­ `node_cpu_utilization` æŒ‡æ ‡ï¼Œè¿‡å» 1 å°æ—¶å†…å„èŠ‚ç‚¹çš„ CPU ä½¿ç”¨ç‡è¶‹åŠ¿ã€‚
```

**AI è§£æçš„ JSON å“åº”**

```json
{
    "intent": "metrics_monitoring",
    "query_keywords": ["Kubernetes", "node_cpu_utilization", "1 å°æ—¶"],
    "suggested_api": {
        "service": "prometheus",
        "query": {
            "metric": "node_cpu_utilization",
            "time_range": "1h",
            "aggregation": "node"
        }
    }
}
```

---

#### **5. ä»£ç å®ç°**

```python
import json
from openai import OpenAI

client = OpenAI(
    api_key="your-api-key",
    base_url="https://api.deepseek.com"
)

system_prompt = """
ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½è¿ç»´åŠ©æ‰‹ï¼Œè´Ÿè´£è§£æç”¨æˆ·è¾“å…¥ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°ä»¥ä¸‹è¿ç»´ä»»åŠ¡ç±»åˆ«ï¼š
- "logs_query"ï¼ˆæ—¥å¿—æŸ¥è¯¢ï¼‰
- "metrics_monitoring"ï¼ˆæŒ‡æ ‡ç›‘æ§ï¼‰
- "alerts_management"ï¼ˆå‘Šè­¦ç®¡ç†ï¼‰
- "resource_cost_estimation"ï¼ˆèµ„æºæˆæœ¬é¢„ä¼°ï¼‰
- "deployment_management"ï¼ˆéƒ¨ç½²ç®¡ç†ï¼‰
- "troubleshooting"ï¼ˆæ•…éšœæ’æŸ¥ï¼‰
- "others"ï¼ˆå…¶ä»–ï¼‰

è¯·æå–ç”¨æˆ·çš„ **æŸ¥è¯¢å…³é”®å­—**ï¼Œå¹¶å°è¯•ç”Ÿæˆé€‚åˆçš„ API æŸ¥è¯¢å‚æ•°ã€‚ä»¥ JSON å½¢å¼è¿”å›ç»“æœã€‚
"""

def get_ai_response(user_input):
    messages = [
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": user_input}
    ]
    
    response = client.chat.completions.create(
        model="deepseek-chat",
        messages=messages,
        response_format={"type": "json_object"}
    )
    
    return json.loads(response.choices[0].message.content)

# ç¤ºä¾‹æµ‹è¯•
user_query = "è¯·æŸ¥è¯¢ 2024-04-01 æœåŠ¡å™¨ 192.168.1.100 çš„ Nginx è®¿é—®æ—¥å¿—ï¼Œç­›é€‰å‡º 500 é”™è¯¯çš„è¯·æ±‚è¯¦æƒ…ã€‚"
parsed_response = get_ai_response(user_query)
print(json.dumps(parsed_response, indent=2, ensure_ascii=False))
```

---

#### **6. æ€»ç»“**

- é€šè¿‡ **æ„å›¾åˆ†ç±» + ä»»åŠ¡æ‹†è§£ + API æ˜ å°„**ï¼Œè®© AI èƒ½ç²¾å‡†å¤„ç†å„ç§è¿ç»´è¯·æ±‚ã€‚
- ä½¿ç”¨ **JSON è¾“å‡º** ç¡®ä¿è¿”å›ç»“æ„åŒ–æ•°æ®ï¼Œä¾¿äºç¨‹åºè§£æä¸è‡ªåŠ¨åŒ–æ‰§è¡Œã€‚
- é‡‡ç”¨ **çµæ´» Prompt è®¾è®¡**ï¼Œè®© AI é€‚åº”ä¸åŒç±»å‹çš„è¿ç»´éœ€æ±‚ã€‚
- ä»£ç ç¤ºä¾‹å¯ä»¥ç›´æ¥æ¥å…¥ **DeepSeek API**ï¼Œç”¨äºæ™ºèƒ½è¿ç»´åŠ©æ‰‹çš„å¼€å‘ã€‚

ä½ å¯ä»¥ç»“åˆä½ çš„ **è¿ç»´å¹³å°ï¼ˆé¡¹ç›®-åº”ç”¨-èŠ‚ç‚¹-ç»„ä»¶ï¼‰**ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ– API å‚æ•°æ˜ å°„ï¼Œè®© AI é€‚åº”ä½ çš„è¿ç»´ä½“ç³» ğŸš€
