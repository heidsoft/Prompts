### **基于宝尊电商的增强意图理解**

为了让 AI 适应 **宝尊电商** 的业务需求，我们需要对 **意图识别** 进行电商场景增强。电商的运维需求通常涉及：

1. **系统监控**（应用健康状态、服务器负载、数据库查询）
2. **业务指标**（订单量、转化率、支付成功率、库存监控）
3. **故障排查**（异常日志、支付失败率、页面加载慢）
4. **资源优化**（云资源成本、服务器扩容、Kubernetes 自动扩缩容）
5. **安全合规**（风控、DDoS 监测、用户数据合规）
6. **营销活动支持**（大促期间系统保障、流量预测）

---

## **1. AI 解析意图的 Prompt 设计**

针对宝尊电商，我们需要 **定制 Prompt**，让 AI 更精准地解析 **运维 & 业务需求**。

### **Prompt 设计**

```
你是一个电商运维智能助手，负责解析用户输入，并将其映射到以下任务类别：
- "system_monitoring"（系统监控：服务器、数据库、网络）
- "business_metrics"（业务指标：订单量、支付成功率、库存）
- "incident_diagnosis"（故障排查：超时、异常日志、支付失败）
- "resource_optimization"（资源优化：服务器扩容、云成本优化）
- "security_compliance"（安全合规：风控、数据合规、DDoS 防御）
- "marketing_support"（营销活动支持：大促保障、流量预测）
- "others"（其他）

请提取用户的 **查询关键字**，并尝试生成适合的 API 查询参数，并以 JSON 形式返回结果。

**示例输入：**
"请帮我查看昨天双十一大促的订单支付成功率，并和去年相比是否有下降？"

**示例 JSON 输出：**
```json
{
    "intent": "business_metrics",
    "query_keywords": ["双十一", "订单", "支付成功率", "去年对比"],
    "suggested_api": {
        "service": "business_analytics",
        "query": {
            "metric": "payment_success_rate",
            "time_range": "yesterday",
            "comparison": "last_year"
        }
    }
}
```

```

---

## **2. AI 任务分类 & 解析示例**
### **示例 1：订单支付成功率监控**
**用户输入**
```

请帮我查看昨天双十一大促的订单支付成功率，并和去年相比是否有下降？

```

**AI 解析的 JSON 响应**
```json
{
    "intent": "business_metrics",
    "query_keywords": ["双十一", "订单", "支付成功率", "去年对比"],
    "suggested_api": {
        "service": "business_analytics",
        "query": {
            "metric": "payment_success_rate",
            "time_range": "yesterday",
            "comparison": "last_year"
        }
    }
}
```

---

### **示例 2：服务器资源使用率**

**用户输入**

```
最近 1 小时网站访问量激增，服务器 CPU 使用率是否超过 80%？需要扩容吗？
```

**AI 解析的 JSON 响应**

```json
{
    "intent": "system_monitoring",
    "query_keywords": ["服务器", "CPU", "使用率", "扩容"],
    "suggested_api": {
        "service": "prometheus",
        "query": {
            "metric": "cpu_utilization",
            "time_range": "1h",
            "threshold": 80
        }
    }
}
```

---

### **示例 3：支付失败分析**

**用户输入**

```
最近用户反馈支付失败率很高，能帮我查查支付宝和微信支付的失败率吗？
```

**AI 解析的 JSON 响应**

```json
{
    "intent": "incident_diagnosis",
    "query_keywords": ["支付失败率", "支付宝", "微信支付"],
    "suggested_api": {
        "service": "elasticsearch",
        "query": {
            "index": "payment-logs",
            "filter": "status:failed AND provider:(Alipay OR WeChatPay)",
            "aggregation": "time_histogram"
        }
    }
}
```

---

### **示例 4：DDoS 攻击检测**

**用户输入**

```
最近网站访问量异常，是否有 DDoS 攻击？需要风控介入吗？
```

**AI 解析的 JSON 响应**

```json
{
    "intent": "security_compliance",
    "query_keywords": ["网站访问量异常", "DDoS 攻击", "风控"],
    "suggested_api": {
        "service": "security_monitor",
        "query": {
            "attack_type": "DDoS",
            "traffic_anomaly": true,
            "risk_management": true
        }
    }
}
```

---

### **示例 5：大促前流量预测**

**用户输入**

```
请预测下周 618 大促期间的 PV 和 UV，看看是否需要增加 CDN 资源？`
```

**AI 解析的 JSON 响应**

```json
{
    "intent": "marketing_support",
    "query_keywords": ["618 大促", "PV", "UV", "CDN 资源"],
    "suggested_api": {
        "service": "traffic_prediction",
        "query": {
            "event": "618",
            "metrics": ["PV", "UV"],
            "suggest_resource": "CDN"
        }
    }
}
```

---

## **3. 代码实现**

```python
import json
from openai import OpenAI

client = OpenAI(
    api_key="your-api-key",
    base_url="https://api.deepseek.com"
)

system_prompt = """
你是一个电商运维智能助手，负责解析用户输入，并将其映射到以下任务类别：
- "system_monitoring"（系统监控：服务器、数据库、网络）
- "business_metrics"（业务指标：订单量、支付成功率、库存）
- "incident_diagnosis"（故障排查：超时、异常日志、支付失败）
- "resource_optimization"（资源优化：服务器扩容、云成本优化）
- "security_compliance"（安全合规：风控、数据合规、DDoS 防御）
- "marketing_support"（营销活动支持：大促保障、流量预测）
- "others"（其他）

请提取用户的 **查询关键字**，并尝试生成适合的 API 查询参数，以 JSON 形式返回。
"""

def get_ai_response(user_input):
    messages = [
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": user_input}
    ]
    
    response = client.chat.completions.create(
        model="deepseek-chat",
        messages=messages,
        response_format={"type": "json_object"}
    )
    
    return json.loads(response.choices[0].message.content)

# 示例测试
user_query = "请帮我查看昨天双十一大促的订单支付成功率，并和去年相比是否有下降？"
parsed_response = get_ai_response(user_query)
print(json.dumps(parsed_response, indent=2, ensure_ascii=False))
```

---

## **4. 总结**

✅ **定制化意图识别**：增强 AI 对 **宝尊电商** 业务的理解，确保准确分类。  
✅ **业务场景覆盖**：涵盖 **监控、分析、预测、风控**，满足电商运维需求。  
✅ **结构化 JSON 响应**：确保输出标准化，可直接用于 API 查询或数据分析。  
✅ **可扩展性强**：可以集成到 **运维平台、AI 监控系统**，提供智能化支持。  

🚀 **下一步**：你可以结合 **DeepSeek API** 直接测试，或进一步细化查询参数，让 AI 更适配 **宝尊电商** 的 **实际数据系统**！
